name: Latest repositories workflow

on:
  schedule:
    - cron: '0 * * * *' # Executar o fluxo de trabalho automaticamente a cada hora, na hora
  workflow_dispatch: # Executar o fluxo de trabalho manualmente

permissions:
  contents: write # Para escrever os conteúdos gerados no arquivo README

jobs:
  update-readme-with-repos:
    name: Update README with latest repositories
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4
      - name: Pull in latest repositories
        run: |
          curl -s "https://api.github.com/users/${{ github.actor }}/repos?per_page=5&sort=created" | jq -r '.[].name' > temp.txt
          cat temp.txt | sed 's/^/```\n/' | sed 's/$/\n```/' > temp_formatted.txt
          sed -i 's/\$/\\n/g' temp_formatted.txt
          sed -i 's/"/\\"/g' temp_formatted.txt
          sed -i ':a;N;$!ba;s/\n/\\n/g' temp_formatted.txt
          sed -i 's/\$/\\n/g' temp_formatted.txt
          sed -i 's/^/"/' temp_formatted.txt
          sed -i 's/$/"/' temp_formatted.txt
          sed -i ':a;N;$!ba;s/\n/,/g' temp_formatted.txt
          sed -i 's/\"/\\\"/g' temp_formatted.txt
          sed -i 's/^/```\n\n## Últimos Repositórios\n\n```markdown\n/g' temp_formatted.txt
          sed -i 's/$/\n\n```/' temp_formatted.txt
          sed -i '1s/^/```markdown\n\n/' temp_formatted.txt
          cat temp_formatted.txt >> README.md
          rm temp.txt temp_formatted.txt
